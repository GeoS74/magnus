1) справочник городов Деловых линий содержит 2 Челябинска.
    Причём в одном из них всего 2 улицы, и те это СНТ
2) отключить в продакшн версии автоматическое индексирование БД
3) поле cityID из справочника терминалов не соответствует cityID справочника населенных пунктов
4) если выбрать какую-нибудь деревню, то день забора груза может быть отодвинут более чем на 10 дней относительно текущей даты.
    Это надо учитывать при обработке ошибки 180012
5) в КИТе пользователь сам генерирует токены, каждый токен имеет свой лимит запроса.
    Не выяснено: объем лимита и возобновляемый лимит или нет
6) РЕШЕНО: при заливке справочника населенных пунктов Деловых линий, может затираться ведущий 0 кода КЛАДР.
    надо контролировать длину кода, которая должна быть 25 символов
    При этом нормальный код КЛАДР - 13 символов
7) РЕШЕНО: в справочнике Деловых есть город Карачаевск (Карачаево-черкесская)
    в справочнике ПЭК город Карачаевск относится к Невинномыску (Ставропольский край)
8) в справочнике ПЭК город Москва - это "Москва Восток"
9) г. Дмитров (Московская обл.) в справочнике Деловых имеет код "5004500000000000000000000"
    в КЛАДР у этого города код "5000006100051".
    Такая же ситуация ещё с несколькими городами Московской области
10) РЕШЕНО: справочник КИТа использует только коды КЛАДР
11) в справочнике ПЭК г. Нерюнгри относится к Благовещенску
12) Решено - г. Петровск в справочнике деловых имеет код 6400000900000000000000000
    в основном справочнике 6402600700000
13) Деловые линии не дают цену по забору груза из г. Петровск (Саратовская обл.)
    Причём на сайте Деловых тоже самое.
14) проверить работу индексов БД
15) справочник КИТа также изменяет коды КЛАДР, укорачивая их на 1 символ.
    Пример:
    //7400000100000 - код Челябинска из основного справочника
    //740000100000 -  код Челябинска из справочника КИТа
16) РЕШЕНО: не понятно что делать с городами типа Воронеж-45
17) Деловые линии ожидают получить параметры ВГХ самого большого места, а не общие
18) Более детально проработать подбор города в ПЭКе. Возможно написать скрипт, который симитирует запросы из основного справочника ко всем справочникам ТК и проанализировать результат.
19) API ПЭКа не позволяет выбрать характер груза и расчитывает перевозку как запасные части (она дороже)
20) в ПЭКе можно расчитать авиадоставку
21) в ПЭКе если cityID меньше 0 (основной город), то расчёт на сайте ПЭКа производится без учёта забора груза, хотя информация по забору предоставляется.
эту ситуацию можно обыграть, но надо ли?
22) СДЭК https://www.cdek.ru/ru/integration
https://api-docs.cdek.ru/29923849.html
https://www.cdek-calc.ru/
23) в справочнике СДЭКа не все города имеют код КЛАДР (прим. Петровск)
24) у СДЭКа разные тарифы для доставки (см. описание). Причём самый дешёвый - это Магистральный экспресс склад-склад
25) email тех. поддержки СДЭК integrator@cdek.ru
26) Подробнее про веб-службы и про технологию SOAP можно прочитать, например, здесь:
http://www.webmascon.com/topics/technologies/8a.asp
27) у DPD есть ограничение на обращения к калькулятору 50.000 запросов в сутки
28) скачать список городов DPD можно по FTP
        Server: ftp.dpd.ru
        Login: integration
        Pass: xYUX~7W98
        Порт: 22
файл называется GeographyDPD, находится в папке integration, в первом столбце таблицы указан параметр cityId, который можно использовать при расчете стоимости доставки по API
29) код из справочника DPD для г. Челябинск
RU74000001000
код из основного справочника
7400000100000
30) в запросах Байкала надо передавать такой заголовок:
'Authorization': `Basic ${base64encode("c54b...562:")}`
т.е. после токена через двоеточие должен быть указан пустой пароль и всё это добро надо закодировать в base64
31) в Байкале можно создать не более 20 ключей
32) надо выбрать приоритетную модель расчёта доставки. Многие перевозчики позволяют рассчитывать доставку как с использованием ВГХ, так и указав объем.
33) Boxberry рекомендует обновлять справочник городов: 1 раз в день.
34) В Boxberry пункты приема/выдачи имеют ограничение по объёму и весу.
    На это надо ориентироваться при расчёте стоимости заказа
    проблема: 
    в коллекции пунктов выдачи разные пункты могут иметь отличающиеся ограничения по максимальному весу и объему
    по идее, для расчёта надо брать пункт с самыми высокими лимитами
    но, теоретически может быть ситуация когда один пункт быдет иметь максимальное значение по весу,
    а другой по объёму. Как выбирать в этом случае не понятно...
35) расчёты в Boxberry и через API сильно отличаются
    Из документации к API: "все или часть услуг не будут рассчитаны и полученная стоимость доставки будет неточной"
36) Boxberry: максимальный вес коробки не должен превышать 15 кг
37) Максимальные габариты для Деловых линий:
    13.6 х 2.4 х 2.4
    Макс. объём 80 м3
    При этом не все терминалы заточены под максимальные габариты (возвращается ошибка 180003)

**)ЖелДорЭкспедиция позволяет получить список городов и доступ к калькулятору без токена



----------Вставить эту фразу на клиенте----------
Точная стоимость перевозки определяется только при обмере груза на терминале. Сроки доставки являются ориентировочными
----------Вставить эту фразу на клиенте----------


Решено -    Деловые Линии (в том числе FTL-подразделение ДЛ-Транс)
Решено -    ПЭК
Решено -    GTD (Кит, Кашалот)
В работе -  ЖелДорЭкспедиция
Решено -    Байкал Сервис
            MagicTrans
            Да-Транс
Решено -    Boxberry        (для юр. лиц)
В работе* - DPD             (для юр. лиц)
            ГлавДоставка
Решено -    СДЭК
            Согруз
В работе -  Энергия (жду окончания работ API v3 для оформления токен, но можно использовать API v2)
            Почта России
            Очаковская Логистическая Компания
            Адамос Логистик
            Возовоз


Точки роста:
1) создать страницу с кнопками для обновления справочников
2) основной справочник загружать через форму
3) переделать option list подбора городов. При вводе латиницы поиск работает, а лист не отображается

Для  Ubuntu:
1) установка MongoDB
https://stackoverflow.com/questions/48092353/failed-to-start-mongod-service-unit-mongod-service-not-found

Удалить файлы, а дальше следовать инструкциям документации
https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/
...


~~~~~~~~~Создание своего справочника КЛАДР
БД КЛАДР
https://fias.nalog.ru/Updates
КЛАДР-Браузер
скачать: 
https://sourceforge.net/projects/kladr-viewer/
описание:
https://www.sitebill.ru/s/topic/2288-%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B6%D0%B0%D0%B5%D0%BC-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B8%D0%B7-%D0%BA%D0%BB%D0%B0%D0%B4%D1%80-%D0%B2-excel-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%86%D0%B8%D1%8F/

Вариант короткий:
1) скачать БД КЛАДР (см. ссылку выше), в архиве несколько файлов .DBF
2) с помощью КЛАДР-браузера открыть БД
3) перевести файл KLADR.DBF в формат .csv
4) выделить необходимые населенные пункты по признаку (горот, пгт и т.д.)
5) вручную выдернуть из БД самый верхний уровень КЛАДР (название областей)
6) свести всё в одну таблицу
7) оставить только актуальные названия (см. расшифровку кодов КЛАДР ниже)
8) ВАЖНО!!! кодировка файла .csv должна быть UTF-8 with BOM

Вариант долгий:
1) скачать БД КЛАДР (см. ссылку выше), в архиве несколько файлов .DBF
2) с помощью КЛАДР-браузера открыть БД
3) перевести файл KLADR.DBF в формат .csv
4) в файле .csv на новой вкладке заполнить вручную регионы и города, которые не помечены серым цветом (цветом помечаются устаревшие данные).
    Должно получиться примерно 637 строчек. Проблема здесь в том, что не все города будут на верхнем уровне, т.к. некоторые (напр. Аша) находятся внутри иерархии (напр. в Ашинском -не)
5) на основной вкаладке .csv перевести коды КЛАДР в нормальный вид, иначе они отображаются примерно так 2,001Е+11
    также следует обратить внимание на то, что коды, начинающиеся на "0" теряют этот ноль.
    Формула для нормализации кода КЛАДР населенного пункта
    =ЕСЛИ( ДЛСТР(C725)=12; "`0"&C725;"`"&C725)
    на выходе: `0200100000000
6) нормализовать код региона. Формула использует значение, полученное при нормализации кода для населенного пункта:
    =ЛЕВСИМВ(J725;3)&"00000000000"
    на выходе: `0200000000000
7) найти строчки, которые уже попали в основной список городов. Формула:
    =ВПР(J725;Лист1!$F$2:$F$638;1;0)
    на выходе: #Н/Д - если код не попал в список, код - если он там уже есть
8) привести значение, полученное в п.п.7 к 0 (код отсутствует) или 1 (код уже есть)
    Формула:
    =ЕСЛИ(ЕСНД(K725;1)=1;0;1)
    на выходе: 0 (код отсутствует) или 1 (код уже есть)
9) установить признак необходимости добавления города в основной список. Для этого используется условие: если код ещё не в основном списке и населенный пункт это город.
    Формула:
    =ЕСЛИ(И(L725=0;B725="г");1;0)
    на выходе: 1 - если надо добавить город в основной список, 0 - если нет
    здесь могут возникнуть дубликаты, например Уфа, в БД через КЛАДР-браузер е неё код 0200000100000, в .csv выгруженном из БД будет 2-е Уфы (хз почему так)
10) проверить на дубликаты. Взять название из колонки NAME и сравнить с наименованием в новом списке.
    Формула:
    =ВПР(A1486;Лист1!$D$2:$D$638;1;0)
    на выходе: #Н/Д - если это не дубликат, либо название города - если это дубликат
11) отфильтровать, оставив те, которых нет в новом списке и убрать дубликаты


Код из КЛАДР г.Долгопрудный
`50 000 029 000 00
`50 019 002 000 51


файл Kladr.dbf – содержит записи с объектами первых четырех уровней классификации (регионы; районы (улусы); города, поселки городского типа, сельсоветы; сельские населенные пункты);
Структура кодового обозначения в блоке "Код":
СС РРР ГГГ ППП АА, где
СС – код субъекта Российской Федерации (региона), коды регионов представлены в Приложении 2 к Описанию классификатора адресов Российской Федерации (КЛАДР);
РРР – код района;
ГГГ – код города;      
ППП – код населенного пункта,
АА – признак актуальности адресного объекта.

Признак актуальности может принимать следующие значения:
            "00” – актуальный объект (его наименование, подчиненность соответствуют состоянию на данный момент адресного пространства). 
            "01”-"50” – объект был переименован, в данной записи приведено одно из прежних его наименований (актуальный адресный объект присутствует в базе данных с тем же кодом, но с признаком актуальности "00”;
            "51” –  объект был переподчинен или влился в состав другого объекта (актуальный адресный объект определяется по базе Altnames.dbf);
            "52”-"98” – резервные значения признака актуальности;
            ”99” – адресный объект не существует, т.е. нет соответствующего ему актуального адресного объекта.
файл Street.dbf – содержит записи с объектами пятого уровня классификации (улицы городов и населенных пунктов);
Структура кодового обозначения в блоке "Код":
СС РРР ГГГ ППП УУУУ АА, где
СС – код субъекта Российской Федерации (региона), коды регионов представлены в Приложении 2 к Описанию классификатора адресов Российской Федерации (КЛАДР);
РРР – код района;
ГГГ – код города;      
ППП – код населенного пункта;    
УУУУ – код улицы;
АА – признак актуальности наименования адресного объекта.

файл Doma.dbf – содержит записи с объектами шестого уровня классификации (номера домов улиц городов и населенных пунктов);
файл Flat.dbf – содержит записи с объектами седьмого уровня классификации (номера квартир домов);
файл Socrbase.dbf – содержит записи с краткими наименованиями типов адресных объектов;
файл Altnames.dbf –содержит сведения о соответствии кодов записей со старыми и новыми наименованиями адресных объектов, а также сведения о соответствии кодов адресных объектов до и после их переподчинения.